# API Documentation

This application exposes a REST API using the Go standard library's `net/http` package. The API serves Prometheus metrics related to vulnerabilities (CVEs) detected in JSON files located in the `data` directory.

## Paradigm
The application follows the REST API paradigm, where the `/metrics` endpoint is exposed to serve Prometheus metrics. The metrics are generated by parsing JSON files containing vulnerability data and are exposed in the Prometheus exposition format.

## API Endpoint
- `/metrics`: This endpoint serves Prometheus metrics related to vulnerabilities detected in the JSON files located in the `data` directory.

## Prometheus Integration
The application integrates with Prometheus by exposing a metrics endpoint (`/metrics`) that Prometheus can scrape to collect vulnerability metrics. The metrics are defined using the `prometheus/client_golang` library.

The `vulnMetric` is a `GaugeVec` metric that tracks CVE occurrences. It has the following labels:
- `cve`: The CVE identifier
- `severity`: The severity of the vulnerability (e.g., high, medium, low)
- `package`: The name of the package affected by the vulnerability
- `version`: The version of the affected package
- `fix_state`: The state of the fix for the vulnerability (e.g., fixed, unfixed)

## Data Processing
The application processes JSON files containing vulnerability data located in the `data` directory. The `parseJSONData` function reads and parses a single JSON file, extracting relevant vulnerability information and updating the `vulnMetric` metric accordingly.

The `processDataFiles` function iterates over all JSON files in the `data` directory and calls `parseJSONData` for each file.

## Periodic Data Processing
The application schedules a job to process the JSON files periodically using a ticker. By default, the data is processed every 20 seconds. This interval can be adjusted by modifying the value passed to `time.NewTicker`.

## Logging
The application logs its activities to a file named `exporter.log`. It also logs incoming HTTP requests using a custom `loggingHandler` middleware.

## Usage
To run the application, execute the binary (`main` function). The server will start listening on `:9092` and serve the `/metrics` endpoint with Prometheus metrics based on the vulnerability data in the `data` directory.

Prometheus can then scrape the `/metrics` endpoint to collect vulnerability metrics and display them in dashboards or trigger alerts based on the metric values.

**Note**: The provided code assumes that the JSON files in the `data` directory follow the `CVEData` and `CVEItem` struct definitions. If the JSON structure differs, the struct definitions may need to be adjusted accordingly.